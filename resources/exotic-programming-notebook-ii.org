#+title: Exotic Programming Notebook II
#+STARTUP: inlineimages
#+PROPERTY: org-image-actual-width 1200

* Exotic mode demo

** Command

#+begin_src sh
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 5 \
  --length 20 \
  --generations 20 \
  --tier super \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 1.0 \
  --log resources/exotic-mode-demo.log
#+end_src

** Notes

- Run completed with exotic scoring enabled.
- Log file: resources/exotic-mode-demo.log

** Log check (last entry)

#+begin_src edn
{:event :run
 :score {:short 34.6883051228524, :xeno 1.0, :final 100.0}
 :program-template :contextual-mutate+mix
 :run/id 5}
#+end_src

* Mission 13: Ratchet memory (stub)

** Notes

- Added `futon5.exotic.ratchet` for window tracking + delta scoring.
- Exotic score now accepts an optional `:ratchet` block with `:prev-score`/`:curr-score`.
- Exotype evolution now maintains a ratchet state and passes `:ratchet` into xenotype scoring after each window.

* Mission 14: Ratchet curriculum (stub)

** Notes

- Added `futon5.exotic.curriculum/curriculum-threshold` with a simple tightening schedule.
- `exoevolve` now attaches `:curriculum` metadata (threshold + window) into the ratchet context.

* Mission 15: Contemplative layer (stub)

** Notes

- Added `futon5.exotic.contemplative` placeholders for provenance, worthiness, and inheritance checks.
- Exotic scoring now accepts optional `:contemplative` inputs and reports a `:contemplative-score` when present.

* Mission 16: Pilot A/B sanity checks

** Pilot 1: Fixed seeds, minimal runs

Compare baseline (no xeno) vs exotic xeno on identical seeds.

#+begin_src sh
# Baseline
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 10 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 4242 \
  --update-every 5 \
  --log resources/mission-16-pilot1-baseline.log

# Exotic
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 10 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 4242 \
  --update-every 5 \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 1.0 \
  --log resources/mission-16-pilot1-exotic.log
#+end_src

** Pilot 1b: Fixed seeds, 50 runs (ratchet visible)

#+begin_src sh
# Baseline
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 50 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 4242 \
  --update-every 5 \
  --log resources/mission-16-pilot1-baseline-r50.log

# Exotic
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 50 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 4242 \
  --update-every 5 \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 1.0 \
  --log resources/mission-16-pilot1-exotic-r50.log
#+end_src

** Pilot 1b notes

- Baseline window means: ~34–43 range across windows.
- Exotic window means: 90–100 range once ratchet context starts flowing.

* Mission 16: CA snapshots (comparable scores)

Baseline and exotype runs use the same initial genotype/phenotype and length=32, generations=64.
Scores below are the standard composite scores from `metrics/summarize-run`.

** Baseline run

- Composite score: 28.83
- Config: `resources/mission-16-baseline.edn`

#+CAPTION: Mission 16 baseline snapshot (composite score 28.83)
#+ATTR_ORG: :width 900
[[file:mission-16-baseline.png]]

** Exotype run (sigil 术, super)

- Composite score: 27.14
- Config: `resources/mission-16-exotic.edn`

#+CAPTION: Mission 16 exotype snapshot (sigil 术, super; composite score 27.14)
#+ATTR_ORG: :width 900
[[file:mission-16-exotic.png]]

* Mission 16: Hot vs cool exotypes (same init state)

All runs share the same initial genotype/phenotype and generations=64.

** Hot (sigil 丁, super, update-prob 1.0)

- Composite score: 34.37
- Config: `resources/mission-16-hot.edn`

#+CAPTION: Mission 16 hot exotype (sigil 丁)
#+ATTR_ORG: :width 900
[[file:mission-16-hot.png]]

** Mid (sigil 乙, super, update-prob 0.5)

- Composite score: 26.44
- Config: `resources/mission-16-mid.edn`

#+CAPTION: Mission 16 mid exotype (sigil 乙)
#+ATTR_ORG: :width 900
[[file:mission-16-mid.png]]

** Cool (sigil 一, super, update-prob 0.25)

- Composite score: 26.41
- Config: `resources/mission-16-cool.edn`

#+CAPTION: Mission 16 cool exotype (sigil 一)
#+ATTR_ORG: :width 900
[[file:mission-16-cool.png]]

* Mission 16: Pilot 2 (rotated seeds, 50 runs)

Aggregate note: pilot2 shows some promise in moving from a hot regime towards a cooler edge-of-chaos regime.

** Batch A (seed 1111)

- Baseline log: `resources/mission-16-pilot2-baseline-a-r50.log`
- Exotic log: `resources/mission-16-pilot2-exotic-a-r50.log`

Baseline CA snapshot (composite score 26.91):

#+CAPTION: Mission 16 pilot2 A baseline (seed 1111)
#+ATTR_ORG: :width 900
[[file:mission-16-pilot2-a-baseline.png]]

Exotype CA snapshot (sigil 术, update-prob 0.5; composite score 32.81):

#+CAPTION: Mission 16 pilot2 A exotype (seed 1111, sigil 术)
#+ATTR_ORG: :width 900
[[file:mission-16-pilot2-a-exotic.png]]

** Batch B (seed 2222)

- Baseline log: `resources/mission-16-pilot2-baseline-b-r50.log`
- Exotic log: `resources/mission-16-pilot2-exotic-b-r50.log`

Baseline CA snapshot (composite score 26.77):

#+CAPTION: Mission 16 pilot2 B baseline (seed 2222)
#+ATTR_ORG: :width 900
[[file:mission-16-pilot2-b-baseline.png]]

Exotype CA snapshot (sigil 术, update-prob 0.5; composite score 30.80):

#+CAPTION: Mission 16 pilot2 B exotype (seed 2222, sigil 术)
#+ATTR_ORG: :width 900
[[file:mission-16-pilot2-b-exotic.png]]

* Mission 17: CT template parsing (checkpoint)

Added two real CT templates in `resources/exotype-xenotype-lift.edn`:
- `f5/p3`
- `f1/p3`

** REPL handshake sanity check

#+begin_src clojure
(require '[futon5.exotic.pattern-repl :as pr]
         '[futon5.exotic.vision :as vision]
         '[futon5.exotic.category :as cat])

(def result (pr/pattern-repl-handshake {:pattern-id "f5/p3" :run-id "demo-ct"}))
(def vis (:vision result))

{:vision-name (:name vis)
 :objects (count (:objects vis))
 :morphisms (count (:morphisms vis))
 :valid? (cat/valid-category? (vision/vision->category vis))}
#+end_src

Expected: non-degenerate vision and `:valid? true`.

** Demo run (lift proposal with evidence)

#+begin_src clojure
(require '[futon5.exotic.pattern-repl :as pr]
         '[futon5.exotic.adapt :as adapt])

(def result (pr/pattern-repl-handshake {:pattern-id "f5/p3"
                                       :run-id "demo-ct-001"
                                       :context {:note "mission-17 demo"}}))
(def evidence (adapt/evidence {:artifact-id "demo-ct-001"
                               :notes "pattern REPL handshake"}))
(def lift (assoc (:lift-proposal result) :evidence evidence))

{:pattern-id (:pattern-id result)
 :vision-name (get-in result [:vision :name])
 :lift-proposal lift}
#+end_src

* Mission 17: Plan/adapt evidence wiring (checkpoint)

** Adaptation log example

#+begin_src clojure
(require '[futon5.exotic.adapt :as adapt]
         '[futon5.exotic.natural :as natural])

(def nt (natural/->NatTrans :demo :plan :plan {:m9 :m9 :m10 :m10}))

(adapt/log-adaptation
 (adapt/adaptation
  {:id "adapt-002"
   :from :plan
   :to :plan
   :evidence (adapt/evidence {:artifact-id "demo-ct-002"
                              :notes "residual demo"})
   :nattrans nt
   :morphisms [:m9 :m10]}))
#+end_src

Expected: `:residuals/by-morphism` present and `:commutativity-residual` <= 1.0.

* Mission 17: Curriculum gating (optional)

** CLI flag

- Use `--curriculum-gate` with `exoevolve` to clamp ratchet deltas below the threshold.

** Example (gated vs ungated)

#+begin_src sh
# Ungated
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 20 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 4242 \
  --update-every 5 \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 1.0 \
  --log resources/mission-17-ungated.log

# Gated
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 20 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 4242 \
  --update-every 5 \
  --curriculum-gate \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 1.0 \
  --log resources/mission-17-gated.log
#+end_src

** Notes

- With the current placeholder exotic score, window means are identical in gated vs ungated runs.
- Gated run logs show `:gate :blocked` when delta falls below threshold (e.g., window 3).

** Visual inspection set (from Pilot 2)

#+CAPTION: Pilot2 A baseline (seed 1111)
#+ATTR_ORG: :width 900
[[file:mission-16-pilot2-a-baseline.png]]

#+CAPTION: Pilot2 A exotype (seed 1111, sigil 术)
#+ATTR_ORG: :width 900
[[file:mission-16-pilot2-a-exotic.png]]

* Mission 18: Usage pointers

See:
- `docs/README-exotic-programming.md` for quick commands.
- `docs/exotic-programming-spec.md` for the current spec and M16–M17 notes.

* Mission 17: Refinement (draft)

** What worked

- Ratchet state now flows into xenotype scoring (visible in logs and window means).
- Exotype selection changes the regime (Pilot 2 shows cooler edge-of-chaos movement).
- CT template handshake produces non-degenerate visions and valid categories.

** What did not work (yet)

- Xenotype scale dominates at `--xeno-weight 1.0` (window means jump to 90–100 vs baseline 34–43).
- Hot vs mid vs cool exotypes are visually closer than intended (mid/cool both “magma”).
- Phenotype layer still destabilizes quickly in hot regimes.

** Parameter sensitivity (current evidence)

- `update-prob 1.0` pushes into hot regimes.
- `update-prob 0.25` and `0.5` are too similar without additional constraints.
- `--xeno-weight 1.0` overwhelms short score; need lower weights for stable blending.

** Stable config candidate (for rerun)

- `--xeno-weight 0.25`
- `--update-every 10`
- Keep `--length 20 --generations 20` for comparability

#+begin_src sh
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 50 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 4242 \
  --update-every 10 \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 0.25 \
  --log resources/mission-17-refine-r50.log
#+end_src

** Next validation

- Re-run Pilot 2 (seeds 1111/2222) with the stable config candidate.
- Compare window means to baseline and confirm the regime shift persists without score blowout.

** Refine run snapshots (stable config)

- Rendered at length 120, generations 120 for readability.
- Early edge-of-chaos structure appears, but the runs destabilize later in the trajectory.

Baseline CA snapshot (composite score 20.39):

#+CAPTION: Mission 17 refine baseline (seed 4242)
#+ATTR_ORG: :width 900
[[file:mission-17-refine-baseline.png]]

Exotype CA snapshot (sigil 土, update-prob 0.25; composite score 21.58):

#+CAPTION: Mission 17 refine exotype (seed 4242, sigil 土)
#+ATTR_ORG: :width 900
[[file:mission-17-refine-exotic.png]]

** Mission 17a variant (xeno-weight 0.2)

- 50-run batch: `resources/mission-17a-refine-r50.log`
- Selected best exotype with update-prob <= 0.5 (sigil 工, update-prob 0.5).
- Visuals show a partially stable edge-of-chaos band within the run window.

Baseline CA snapshot (composite score 26.74):

#+CAPTION: Mission 17a refine baseline (seed 4242)
#+ATTR_ORG: :width 900
[[file:mission-17a-refine-baseline.png]]

Exotype CA snapshot (sigil 工, update-prob 0.5; composite score 24.78):

#+CAPTION: Mission 17a refine exotype (seed 4242, sigil 工)
#+ATTR_ORG: :width 900
[[file:mission-17a-refine-exotic.png]]

* Mission 9.5: Arrow discovery MVP

** Pilot command

#+begin_src sh
bb -cp src:resources -m futon5.arrow.mine \
  --contexts 5 \
  --k 2 \
  --tau 0.6 \
  --min-delta 0.05 \
  --log-tests resources/arrow-pilot-tests.edn \
  --out resources/arrow-pilot.edn
#+end_src

** Notes

- MVP uses a tiny term grammar and coarse regimes (:dead/:stable/:oscillating/:chaotic).
- Output is a single EDN payload with discovered arrows and robustness.
- Pilot result (contexts=5, k=2, tau=0.6, min-delta=0.05): 7 arrows found with coarse bins + effect-size filter.
- Null baseline (label shuffle on regime sigs): ~0.30 pass rate (still nontrivial; needs tightening).
- No-op control: `[:noop]` yields τ=1.0 but small Δ (~0.024), rejected by min-delta.

** Sample arrow

#+begin_src clojure
{:from {:regime :oscillating, :sig 1677116182}
 :witness {:term [:set-exotype "丁" :super], :cost 1}
 :to {:word-class :chaotic, :sig 1709907411}
 :robustness {:tau 0.8, :contexts 5}
 :effect {:delta 0.1243}}
#+end_src

** Buckets (heuristic)

- strong: 0
- medium: 5
- weak: 2

** Manual trace inspection (strongest delta)

Witness term: `[:set-exotype "厂" :super]` (tau=1.0, delta≈0.49)

Before (noop) composite score: 37.31  
After (term) composite score: 23.02

#+CAPTION: Arrow pilot before (noop)
#+ATTR_ORG: :width 900
[[file:arrow-best-before.png]]

#+CAPTION: Arrow pilot after (set-exotype 厂, super)
#+ATTR_ORG: :width 900
[[file:arrow-best-after.png]]

Question this arrow answers (tentative): how does switching to a specific super‑exotype alter macro‑structure while holding initial state fixed?

** Medium-arrow trace inspections (top 4 nontrivial by delta)

1) term `[:set-exotype "十" :super]` (tau=1.0, delta≈0.227)
- before: 35.32, after: 26.50

#+CAPTION: Arrow medium 01 before (noop)
#+ATTR_ORG: :width 900
[[file:arrow-medium-01-before.png]]

#+CAPTION: Arrow medium 01 after (set-exotype 十, super)
#+ATTR_ORG: :width 900
[[file:arrow-medium-01-after.png]]

2) term `[:set-exotype "丁" :super]` (tau=0.8, delta≈0.124)
- before: 38.08, after: 38.31

#+CAPTION: Arrow medium 02 before (noop)
#+ATTR_ORG: :width 900
[[file:arrow-medium-02-before.png]]

#+CAPTION: Arrow medium 02 after (set-exotype 丁, super)
#+ATTR_ORG: :width 900
[[file:arrow-medium-02-after.png]]

3) term `[:set-param :rotation 1.0]` (tau=0.6, delta≈0.077)
- before: 35.28, after: 34.59

#+CAPTION: Arrow medium 03 before (noop)
#+ATTR_ORG: :width 900
[[file:arrow-medium-03-before.png]]

#+CAPTION: Arrow medium 03 after (rotation +1)
#+ATTR_ORG: :width 900
[[file:arrow-medium-03-after.png]]

4) term `[:set-exotype "二" :super]` (tau=0.6, delta≈0.052)
- before: 34.90, after: 34.58

#+CAPTION: Arrow medium 04 before (noop)
#+ATTR_ORG: :width 900
[[file:arrow-medium-04-before.png]]

#+CAPTION: Arrow medium 04 after (set-exotype 二, super)
#+ATTR_ORG: :width 900
[[file:arrow-medium-04-after.png]]

Note: entries 3–4 are at the weak/medium boundary; keep for contrast.

** Arrow questions (tentative)

- `[:set-exotype "十" :super]`: How does switching to this super‑exotype dampen macro‑activity without immediate collapse?
- `[:set-exotype "丁" :super]`: How does a super‑exotype push oscillating regimes into chaotic ones without large score shifts?
- `[:set-param :rotation 1.0]`: How sensitive is the regime to small rotational tweaks in context alignment?
- `[:set-exotype "二" :super]`: What minimal exotype switch yields a shallow but repeatable macro shift?

** Pilot 2: Two batches, rotated seeds

#+begin_src sh
# Batch A
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 20 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 1111 \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 1.0 \
  --log resources/mission-16-pilot2-a.log

# Batch B
bb -cp src:resources -m futon5.mmca.exoevolve \
  --runs 20 \
  --length 20 \
  --generations 20 \
  --tier super \
  --seed 2222 \
  --xeno-spec resources/exotic-xenotype-example.edn \
  --xeno-weight 1.0 \
  --log resources/mission-16-pilot2-b.log
#+end_src
